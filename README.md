# ValutaTrade Hub

ValutaTrade Hub — учебное консольное (CLI) приложение для управления валютным портфелем пользователя.

Проект реализован как учебный, с упором на:
- строгую бизнес-логику;
- валидацию пользовательского ввода;
- отказоустойчивость;
- воспроизводимость проверок;
- дисциплину работы с Git.

---

## Назначение проекта

Функциональность приложения:
- регистрация и аутентификация пользователей;
- управление валютным портфелем;
- покупка и продажа валют;
- получение курсов валют;
- кеширование курсов с TTL;
- логирование доменных операций;
- работа с JSON-хранилищем (без использования БД).

---

## Рабочее окружение

**ОС:** Ubuntu (WSL)

**Рабочий каталог:**
/home/student/projects/finalproject_Andreenko_Andrey_dpo_v2

---

## Репозиторий GitHub

https://github.com/AndreyAU/finalproject_Andreenko_Andrey_dpo_v2

---

## Структура проекта

finalproject_Andreenko_Andrey_dpo_v2/
├── data/
│   ├── users.json            — зарегистрированные пользователи
│   ├── portfolios.json       — портфели пользователей
│   ├── rates.json            — кеш курсов валют
│   └── current_user.json     — текущая пользовательская сессия
│
├── logs/
│   └── actions.log           — логи доменных операций BUY / SELL
│
├── valutatrade_hub/
│   ├── cli/
│   │   └── interface.py      — CLI-меню и обработка пользовательского ввода
│   │
│   ├── core/
│   │   ├── currencies.py     — иерархия валют и строгая валидация кодов
│   │   ├── models.py         — модель пользователя (хеширование пароля)
│   │   ├── usecases.py       — бизнес-логика (use cases)
│   │   └── exceptions.py     — доменные исключения
│   │
│   ├── decorators.py         — декоратор логирования операций
│   ├── logging_config.py     — настройка логирования и ротации
│   └── infra/
│       └── settings.py       — загрузка настроек проекта
│
├── Makefile
├── .gitignore
└── README.md

---

## Установка

Проект не использует сторонние библиотеки и работает на стандартной библиотеке Python.

Требования:
- Python 3.9+

Формальная установка (по ТЗ):
make install

---

## Подготовка к запуску (ВАЖНО)

Перед каждым чистым запуском или демонстрацией проекта необходимо очистить runtime-данные.

### Очистка JSON-хранилищ
git restore data/

Ожидаемое состояние:
- users.json → []
- portfolios.json → []
- rates.json → {}

### Очистка логов
rm -f logs/actions.log

JSON-файлы и логи **не коммитятся** в Git и используются только во время выполнения.

---

## Запуск приложения

Рекомендуемый способ:
make project

Альтернативный запуск:
python3 -m valutatrade_hub.cli.interface

---

## CLI-меню

После запуска отображается меню:

1. Регистрация  
2. Вход  
3. Показать портфель  
4. Купить валюту  
5. Продать валюту  
6. Получить курс валют  
0. Выход  

Логика доступа:
- регистрация и вход доступны всегда;
- операции с портфелем требуют активной пользовательской сессии.

---

## Этап 3. Иерархия валют и бизнес-логика (3.1–3.6)

### Иерархия валют (3.1–3.3)

Реализована строгая модель:
- Currency — абстрактный базовый класс;
- FiatCurrency;
- CryptoCurrency.

Инварианты кодов валют:
- строка;
- длина 2–5 символов;
- строгий верхний регистр;
- без пробелов.

Некорректные коды приводят к CurrencyNotFoundError.

---

### BUY / SELL (3.4)

Реализовано:
- строгая проверка amount > 0;
- автоматическое создание кошелька при первой покупке;
- проверка наличия кошелька при продаже;
- проверка достаточности средств (InsufficientFundsError);
- атомарная запись изменений в JSON;
- логирование операций BUY / SELL.

---

### GET-RATE и кеш курсов (3.5–3.6)

Файл кеша:
data/rates.json

Алгоритм:
1. Валидация валют.
2. Попытка взять курс из кеша.
3. Проверка TTL.
4. При отсутствии или устаревании — вызов Parser Service (stub).
5. Сохранение курса и времени обновления.

Поддерживается обратный курс (например USD → BTC).  
Неподдерживаемые пары (например BTC → EUR) приводят к ApiRequestError.

---

## Логирование и ротация

Настройка: logging_config.py

Характеристики:
- используется RotatingFileHandler;
- файл: logs/actions.log;
- логируются только доменные операции;
- уровни: INFO, ERROR.

Пример:
INFO BUY user=1 currency=BTC amount=0.5 rate=59337.21 base=USD result=OK  
ERROR SELL result=ERROR error_type=InsufficientFundsError ...

---

## Git-дисциплина

В репозиторий попадает только код.

Не коммитятся:
- data/*.json
- logs/*.log
- *.cast (asciinema)

Все этапы разработки фиксируются отдельными осмысленными коммитами.

---

## Демо работы приложения (asciinema)

### Этап 2 — базовая платформа торговли валютами

Запись демонстрирует:
- базовый CLI;
- регистрацию и логин;
- покупку и продажу валют;
- просмотр портфеля;
- получение курсов валют.

Ссылка на запись этапа 2:
https://asciinema.org/a/TYdDWIJxHNI6K1BN

---

### Этап 3 — иерархия валют и бизнес-логика (3.1–3.6)

Запись демонстрирует:
- контроль доступа;
- регистрацию и логин;
- строгую валидацию валют;
- BUY / SELL;
- обработку ошибок;
- работу кеша курсов;
- логирование доменных операций.

Ссылка на запись этапа 3:
https://asciinema.org/a/uzqh0PWH6Ez2FuG4

---

## Статус проекта

- Этапы 3.1–3.6 реализованы полностью
- Проверены через CLI
- Зафиксированы в Git
- Проект готов к следующему этапу

