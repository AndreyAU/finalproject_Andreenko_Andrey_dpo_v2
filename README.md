# ValutaTrade Hub

ValutaTrade Hub — учебное консольное (CLI) приложение для управления валютным портфелем пользователя.

Проект реализован как учебный, с упором на:
- строгую бизнес-логику;
- валидацию пользовательского ввода;
- отказоустойчивость;
- воспроизводимость проверок;
- дисциплину работы с Git.

---

## Назначение проекта

Функциональность приложения:
- регистрация и аутентификация пользователей;
- управление валютным портфелем;
- покупка и продажа валют;
- получение курсов валют;
- кеширование курсов с TTL;
- логирование доменных операций;
- работа с JSON-хранилищем (без использования БД);
- парсинг курсов валют из внешних API (этап 4).

---

## Рабочее окружение

**ОС:** Ubuntu (WSL)

**Рабочий каталог:**
/home/student/projects/finalproject_Andreenko_Andrey_dpo_v2

---

## Репозиторий GitHub

https://github.com/AndreyAU/finalproject_Andreenko_Andrey_dpo_v2

---

## Структура проекта

finalproject_Andreenko_Andrey_dpo_v2/
├── data/
│   ├── users.json                — зарегистрированные пользователи  
│   ├── portfolios.json           — портфели пользователей  
│   ├── rates.json                — кеш курсов валют (snapshot)  
│   ├── exchange_rates.json       — история курсов (append-only журнал)  
│   └── current_user.json         — текущая пользовательская сессия  
│
├── logs/
│   └── actions.log               — логи доменных операций BUY / SELL  
│
├── recordings/
│   └── stage4.cast               — asciinema-запись этапа 4  
│
├── valutatrade_hub/
│   ├── cli/
│   │   └── interface.py          — CLI-меню и обработка пользовательского ввода  
│   │
│   ├── core/
│   │   ├── currencies.py         — иерархия валют и строгая валидация кодов  
│   │   ├── models.py             — модель пользователя (хеширование пароля)  
│   │   ├── usecases.py           — бизнес-логика (use cases)  
│   │   └── exceptions.py         — доменные исключения  
│   │
│   ├── parser_service/
│   │   ├── config.py             — конфигурация Parser Service  
│   │   ├── api_clients.py        — клиенты внешних API  
│   │   ├── storage.py            — работа с rates.json и exchange_rates.json  
│   │   └── updater.py            — координатор обновления курсов  
│   │
│   ├── decorators.py             — декоратор логирования операций  
│   ├── logging_config.py         — настройка логирования и ротации  
│   └── infra/
│       └── settings.py           — загрузка настроек проекта  
│
├── Makefile  
├── .gitignore  
└── README.md  

---

## Установка

Проект не использует сторонние библиотеки и работает на стандартной библиотеке Python.

Требования:
- Python 3.9+

Формальная установка (по ТЗ):
make install

---

## Подготовка к запуску (ВАЖНО)

Перед каждым чистым запуском или демонстрацией проекта необходимо очистить runtime-данные.

Очистка JSON-хранилищ:
: > data/users.json  
: > data/portfolios.json  
: > data/current_user.json  
: > data/rates.json  
: > data/exchange_rates.json  

Очистка логов:
: > logs/actions.log  

JSON-файлы и логи не коммитятся в Git и используются только во время выполнения.

---

## Переменная окружения EXCHANGERATE_API_KEY (этап 4)

Для получения фиатных курсов используется сервис ExchangeRate-API.

Ключ не хранится в коде и передаётся через переменную окружения:

export EXCHANGERATE_API_KEY=ВАШ_КЛЮЧ

В коде ключ читается через:
os.getenv("EXCHANGERATE_API_KEY")

Пояснение для преподавателя (1 фраза):

«Ключ ExchangeRate-API передаётся через переменную окружения перед запуском проекта. Если ключ отсутствует, сервис работает в деградированном режиме только с CoinGecko.»

---

## Запуск приложения

Рекомендуемый способ:
make project

Альтернативный запуск:
python3 -m valutatrade_hub.cli.interface

---

## CLI-меню

После запуска отображается меню:

1. Регистрация  
2. Вход  
3. Показать портфель  
4. Купить валюту  
5. Продать валюту  
6. Получить курс валют  
7. Обновить курсы валют (update-rates)  
8. Показать курсы из кеша (show-rates)  
0. Выход  

Логика доступа:
- регистрация и вход доступны всегда;
- операции с портфелем требуют активной пользовательской сессии.

---

## Этап 3. Иерархия валют и бизнес-логика (3.1–3.6)

Реализована строгая модель:
- Currency — абстрактный базовый класс;
- FiatCurrency;
- CryptoCurrency.

Инварианты кодов валют:
- строка;
- длина 2–5 символов;
- строгий верхний регистр;
- без пробелов.

Реализованы BUY / SELL, кеш курсов, TTL, обратные курсы, логирование доменных операций.

---

## Этап 4. Parser Service и внешние API

Реализовано:
- ParserConfig — единая конфигурация сервиса;
- BaseApiClient — абстракция клиента API;
- CoinGeckoClient — криптовалюты;
- ExchangeRateApiClient — фиатные валюты;
- RatesUpdater — координация обновления;
- RatesStorage — атомарная запись snapshot и истории.

Файлы:
- data/rates.json — актуальный snapshot курсов;
- data/exchange_rates.json — append-only журнал всех измерений.

Каждая запись истории содержит:
- уникальный id = FROM_TO_TIMESTAMP;
- валютную пару;
- курс;
- источник;
- timestamp (UTC).

Поддержан деградированный режим без API-ключа.

---

## Логирование и ротация

Используется RotatingFileHandler.

Файл:
logs/actions.log

Логируются:
- обновления курсов;
- BUY / SELL операции.

---

## Git-дисциплина

В репозиторий попадает только код.

Не коммитятся:
- data/*.json
- logs/*.log
- *.cast

---

## Демо работы приложения (asciinema)

Этап 2 — базовая платформа торговли валютами:  
https://asciinema.org/a/TYdDWIJxHNI6K1BN

Этап 3 — иерархия валют и бизнес-логика:  
https://asciinema.org/a/uzqh0PWH6Ez2FuG4

Этап 4 — Parser Service + внешние API + show-rates:  
https://asciinema.org/a/Q69kXB3LvI2zNtgk

---

## Статус проекта

- Этапы 1-4 реализованы полностью  
- Проверены через CLI и asciinema  
- Зафиксированы в Git  
- Проект готов 

